/*-----------------------------------------------------------------------------*
								IRT MATH TEST SCORES  YC - CHILD SURVEY
------------------------------------------------------------------------------*/
cd "D:/1.RESEARK/9.THESIS materials/thesis/data"

// ssc install raschtest

* ROUND 3

use "vn_r3yc_childlevel.dta",clear
keep MTHITM* math math_co CHILDID rmath_co math_co math
mvdecode _all, mv(77 88 99 79=. \ -77 -88 -99 -79=. \7777 8888=.a)
rename CHILDID childid
rename  MTHITM*  correct*
rename correct0* correct*
gen round =3
drop if math==.

* Recode 
forvalues num =1/9{
	recode correct`num' 2=0
   }

forvalues num =1/29{
      replace correct`num' = 0 if correct`num'==.
   }
merge 1:1 childid round using "vietnam_constructed.dta"
drop if _merge==2
keep childid round correct1-correct29 math math_co round typesite clustid region childloc dint chsex chethnic

save "mathtestr3.dta",replace

raschtest correct1-correct29,id(childid) genlt(ltscore)
* Or
irt 1pl correct1 - correct11 correct13-correct29
estat report, sort(b) byparm
predict Theta, latent
irtgraph tcc, scorelines(5 10 15 25)
 *** --------------------------
irt 1pl correct1- correct11 correct13-correct29, group(typesite)
 estat greport
/*
----------------------------------------
   Parameter |   urban        rural     
-------------+--------------------------
correct1     |
     Discrim |  1.9208228    1.9208228  
        Diff | -3.7808553   -3.7808553  
-------------+--------------------------
correct2     |
     Discrim |  1.9208228    1.9208228  
        Diff | -2.9169599   -2.9169599  
-------------+--------------------------
correct3     |
     Discrim |  1.9208228    1.9208228  
        Diff | -3.4467562   -3.4467562  
-------------+--------------------------
correct4     |
     Discrim |  1.9208228    1.9208228  
        Diff | -3.1941935   -3.1941935  
-------------+--------------------------
correct5     |
     Discrim |  1.9208228    1.9208228  
        Diff |  -.7838399    -.7838399  
-------------+--------------------------
correct6     |
     Discrim |  1.9208228    1.9208228  
        Diff | -.40976892   -.40976892  
-------------+--------------------------
correct7     |
     Discrim |  1.9208228    1.9208228  
        Diff |  -2.459707    -2.459707  
-------------+--------------------------
correct8     |
     Discrim |  1.9208228    1.9208228  
        Diff | -1.6707342   -1.6707342  
-------------+--------------------------
correct9     |
     Discrim |  1.9208228    1.9208228  
        Diff | -1.9238692   -1.9238692  
-------------+--------------------------
correct10    |
     Discrim |  1.9208228    1.9208228  
        Diff | -3.1592682   -3.1592682  
-------------+--------------------------
correct11    |
     Discrim |  1.9208228    1.9208228  
        Diff | -3.0631348   -3.0631348  
-------------+--------------------------
correct13    |
     Discrim |  1.9208228    1.9208228  
        Diff | -2.2662001   -2.2662001  
-------------+--------------------------
correct14    |
     Discrim |  1.9208228    1.9208228  
        Diff | -2.1819797   -2.1819797  
-------------+--------------------------
correct15    |
     Discrim |  1.9208228    1.9208228  
        Diff | -.77149913   -.77149913  
-------------+--------------------------
correct16    |
     Discrim |  1.9208228    1.9208228  
        Diff | -2.2309103   -2.2309103  
-------------+--------------------------
correct17    |
     Discrim |  1.9208228    1.9208228  
        Diff | -2.1601427   -2.1601427  
-------------+--------------------------
correct18    |
     Discrim |  1.9208228    1.9208228  
        Diff | -.63814882   -.63814882  
-------------+--------------------------
correct19    |
     Discrim |  1.9208228    1.9208228  
        Diff |  .06440846    .06440846  
-------------+--------------------------
correct20    |
     Discrim |  1.9208228    1.9208228  
        Diff |  -.3134499    -.3134499  
-------------+--------------------------
correct21    |
     Discrim |  1.9208228    1.9208228  
        Diff | -1.0408769   -1.0408769  
-------------+--------------------------
correct22    |
     Discrim |  1.9208228    1.9208228  
        Diff | -.56112512   -.56112512  
-------------+--------------------------
correct23    |
     Discrim |  1.9208228    1.9208228  
        Diff | -.35464115   -.35464115  
-------------+--------------------------
correct24    |
     Discrim |  1.9208228    1.9208228  
        Diff | -.55586933   -.55586933  
-------------+--------------------------
correct25    |
     Discrim |  1.9208228    1.9208228  
        Diff | -.69594589   -.69594589  
-------------+--------------------------
correct26    |
     Discrim |  1.9208228    1.9208228  
        Diff |  .02089357    .02089357  
-------------+--------------------------
correct27    |
     Discrim |  1.9208228    1.9208228  
        Diff | -.53834238   -.53834238  
-------------+--------------------------
correct28    |
     Discrim |  1.9208228    1.9208228  
        Diff |  1.5186601    1.5186601  
-------------+--------------------------
correct29    |
     Discrim |  1.9208228    1.9208228  
        Diff |   .2122888     .2122888  
-------------+--------------------------
  mean(Theta)| -1.527e-16   -.73143243  
   var(Theta)|          1    .92805714  
----------------------------------------

----------------------------------------
   Parameter | 0.majore~c   1.majore~c  
-------------+--------------------------
correct1     |
     Discrim |  2.8945738    2.8945738  
        Diff | -1.8828625   -1.8828625  
-------------+--------------------------
correct2     |
     Discrim |  1.3381422    1.3381422  
        Diff |  -1.875882    -1.875882  
-------------+--------------------------
correct3     |
     Discrim |   2.507525     2.507525  
        Diff | -1.6401236   -1.6401236  
-------------+--------------------------
correct4     |
     Discrim |  .43016809    .43016809  
        Diff | -7.3162872   -7.3162872  
-------------+--------------------------
correct5     |
     Discrim |  1.5836685    1.5836685  
        Diff |  .75205386    .75205386  
-------------+--------------------------
correct6     |
     Discrim |  1.6757592    1.6757592  
        Diff |  1.1227096    1.1227096  
-------------+--------------------------
correct7     |
     Discrim |  1.1546777    1.1546777  
        Diff | -1.5318766   -1.5318766  
-------------+--------------------------
correct8     |
     Discrim |  1.6919773    1.6919773  
        Diff | -.13587435   -.13587435  
-------------+--------------------------
correct9     |
     Discrim |  2.0981908    2.0981908  
        Diff | -.25739053   -.25739053  
-------------+--------------------------
correct10    |
     Discrim |  1.2003241    1.2003241  
        Diff | -2.4269305   -2.4269305  
-------------+--------------------------
correct11    |
     Discrim |  1.7694972    1.7694972  
        Diff | -1.6081515   -1.6081515  
-------------+--------------------------
correct13    |
     Discrim |  1.4249253    1.4249253  
        Diff |  -.9664932    -.9664932  
-------------+--------------------------
correct14    |
     Discrim |  1.5017349    1.5017349  
        Diff | -.80549431   -.80549431  
-------------+--------------------------
correct15    |
     Discrim |  1.5165018    1.5165018  
        Diff |  .75817586    .75817586  
-------------+--------------------------
correct16    |
     Discrim |  1.7417838    1.7417838  
        Diff | -.71098854   -.71098854  
-------------+--------------------------
correct17    |
     Discrim |  1.9051447    1.9051447  
        Diff | -.55958096   -.55958096  
-------------+--------------------------
correct18    |
     Discrim |  1.8357539    1.8357539  
        Diff |  .90787832    .90787832  
-------------+--------------------------
correct19    |
     Discrim |   1.812679     1.812679  
        Diff |  1.5477846    1.5477846  
-------------+--------------------------
correct20    |
     Discrim |  1.8615086    1.8615086  
        Diff |  1.2028976    1.2028976  
-------------+--------------------------
correct21    |
     Discrim |  2.2727162    2.2727162  
        Diff |  .57954036    .57954036  
-------------+--------------------------
correct22    |
     Discrim |  2.2739768    2.2739768  
        Diff |  .98283727    .98283727  
-------------+--------------------------
correct23    |
     Discrim |  2.5730305    2.5730305  
        Diff |  1.1452713    1.1452713  
-------------+--------------------------
correct24    |
     Discrim |  4.6831417    4.6831417  
        Diff |   .9993499     .9993499  
-------------+--------------------------
correct25    |
     Discrim |  6.6992295    6.6992295  
        Diff |  .91605257    .91605257  
-------------+--------------------------
correct26    |
     Discrim |  6.3354541    6.3354541  
        Diff |  1.3507879    1.3507879  
-------------+--------------------------
correct27    |
     Discrim |  6.6862147    6.6862147  
        Diff |  1.0145988    1.0145988  
-------------+--------------------------
correct28    |
     Discrim |  2.5548807    2.5548807  
        Diff |  2.5576907    2.5576907  
-------------+--------------------------
correct29    |
     Discrim |  5.4297699    5.4297699  
        Diff |  1.4719088    1.4719088  
-------------+--------------------------
  mean(Theta)|          0    1.0597034  
   var(Theta)|          1     .6126907  
----------------------------------------

*/
irt 2pl correct1- correct11 correct13-correct29, group(typesite)
estat greport
estimates store constrained

irt hybrid (2pl correct1-correct11 correct14-correct27 correct29) (1:2pl correct13 correct28) (2:2pl correct13 correct28), group(typesite)
estat greport
estimates store diff1
/*
----------------------------------------
   Parameter |   urban        rural     
-------------+--------------------------

-------------+--------------------------
correct4     |
     Discrim |  2.2054374    .19009887  
        Diff | -3.3416307   -18.014797  
-------------+--------------------------
correct13    |
     Discrim |  .81642619    1.3899911  
        Diff | -3.5913166   -2.5980869  
-------------+--------------------------
correct28    |
     Discrim |   1.705367    2.3679967  
        Diff |   1.820423    1.2176299  
-------------+--------------------------
  mean(Theta)|          0   -.69180145  
   var(Theta)|          1    .98226197  
----------------------------------------


----------------------------------------
   Parameter | 0.majore~c   1.majore~c  
-------------+--------------------------

-------------+--------------------------
correct13    |
     Discrim |  1.5573441    1.4461699  
        Diff | -.98205636   -.92689264  
-------------+--------------------------
correct28    |
     Discrim |  1.8934719    2.5410938  
        Diff |  3.6491018    2.5392318  
-------------+--------------------------
  mean(Theta)|          0    1.0533102  
   var(Theta)|          1    .60421823  
----------------------------------------

*/

 lrtest ethconstrained dif2
 
 
gen maths_irt = (50 + 10*ltscore)/10

save "ltscorer3_maths.dta",replace

* ROUND 4
use "vn_r4_yccog_youngerchildtest.dta",clear
gen childid="VN"+string(CHILDCODE, "%06.0f")
	
drop if MATHTEST==0

keep childid correct*maths maths_raw
rename correct*maths correct*
rename correct0* correct*


forvalues num =1/34{
      replace correct`num' = 0 if correct`num'==.
   }
 
tempfile mathtestr4
save `mathtestr4'

tabulate maths_raw

raschtest correct1-correct34,id( childid)
/*
At least one group of scores concerns none individuals. Tests will be not computed.
Use the group or the autogroup options.

Estimation method: Conditional maximum likelihood (CML)
Number of items: 34
Number of groups: 35
Number of individuals: 1936
Number of individuals with missing values: 0 (removed)
Number of individuals with nul or perfect score: 24
Conditional log-likelihood: -28467.8006  
Log-likelihood: -31878.2516  
               Difficulty
        Items  parameters  std Err.
-----------------------------------
      correct1   -4.30105   0.10387
      correct2   -4.21691   0.10202
      correct3   -3.94135   0.09669
      correct4   -3.52851   0.09046
      correct5   -3.47958   0.08985
      correct6   -3.12650   0.08610
      correct7   -0.05804   0.08798
      correct8   -0.81265   0.08220
      correct9   -2.97253   0.08480
     correct10   -1.20434   0.08075
     correct11   -2.99805   0.08500
     correct12   -2.30918   0.08116
     correct13   -2.31438   0.08118
     correct14   -0.74714   0.08254
     correct15   -2.28325   0.08107
     correct16   -1.90317   0.08025
     correct17   -0.26472   0.08594
     correct18   -1.10041   0.08105
     correct19   -1.72105   0.08013
     correct20   -0.39902   0.08481
     correct21   -1.47685   0.08025
     correct22   -2.27033   0.08103
     correct23   -2.31959   0.08119
     correct24   -1.36696   0.08040
     correct25   -0.37935   0.08497
     correct26   -1.27597   0.08058
     correct27   -0.02730   0.08832
     correct28   -0.93191   0.08166
     correct29    0.21178   0.09128
     correct30   -0.52939   0.08386
     correct31   -0.59676   0.08341
     correct32   -1.53139   0.08019
     correct33    0.15971   0.09058
    correct34*    0.00000        .
-----------------------------------
*: The difficulty parameter of this item had been fixed to 0
                                Ability                    Expected
                Group Score  parameters  std Err.    Freq.    Score
                ---------------------------------------------------
                    0     0      -6.790     1.506       24     0.46
                ---------------------------------------------------
                    1     1      -5.596     0.902        7     1.39
                ---------------------------------------------------
                    2     2      -4.988     0.723       10     2.33
                ---------------------------------------------------
                    3     3      -4.554     0.632       16     3.29
                ---------------------------------------------------
                    4     4      -4.206     0.575       14     4.25
                ---------------------------------------------------
                    5     5      -3.908     0.536        9     5.22
                ---------------------------------------------------
                    6     6      -3.644     0.507       25     6.20
                ---------------------------------------------------
                    7     7      -3.404     0.484       32     7.18
                ---------------------------------------------------
                    8     8      -3.182     0.466       43     8.16
                ---------------------------------------------------
                    9     9      -2.975     0.452       60     9.14
                ---------------------------------------------------
                   10    10      -2.779     0.441       65     10.13
                ---------------------------------------------------
                   11    11      -2.592     0.431       91     11.11
                ---------------------------------------------------
                   12    12      -2.413     0.423      114     12.10
                ---------------------------------------------------
                   13    13      -2.239     0.416      113     13.08
                ---------------------------------------------------
                   14    14      -2.071     0.411      146     14.07
                ---------------------------------------------------
                   15    15      -1.906     0.407      155     15.05
                ---------------------------------------------------
                   16    16      -1.744     0.404      154     16.04
                ---------------------------------------------------
                   17    17      -1.584     0.402      105     17.03
                ---------------------------------------------------
                   18    18      -1.426     0.401      117     18.01
                ---------------------------------------------------
                   19    19      -1.268     0.401      107     18.99
                ---------------------------------------------------
                   20    20      -1.110     0.402       82     19.97
                ---------------------------------------------------
                   21    21      -0.950     0.405       84     20.96
                ---------------------------------------------------
                   22    22      -0.789     0.408       73     21.93
                ---------------------------------------------------
                   23    23      -0.624     0.414       60     22.91
                ---------------------------------------------------
                   24    24      -0.454     0.421       47     23.89
                ---------------------------------------------------
                   25    25      -0.278     0.430       51     24.86
                ---------------------------------------------------
                   26    26      -0.093     0.442       51     25.83
                ---------------------------------------------------
                   27    27       0.104     0.458       29     26.81
                ---------------------------------------------------
                   28    28       0.316     0.479       23     27.78
                ---------------------------------------------------
                   29    29       0.550     0.507       14     28.74
                ---------------------------------------------------
                   30    30       0.815     0.545       13     29.70
                ---------------------------------------------------
                   31    31       1.129     0.602        2     30.66
                ---------------------------------------------------
                   32    32       1.527     0.694        0     31.62
                ---------------------------------------------------
                   33    33       2.097     0.873        0     32.58
                ---------------------------------------------------
                   34    34       3.253     1.473        0     33.53
                ---------------------------------------------------
*/

raschtest correct1-correct34,id(childid) genlt(ltscore)
tab ltscore
/*

    ltscore |      Freq.     Percent        Cum.
------------+-----------------------------------
      -6.79 |         24        1.24        1.24
     -5.596 |          7        0.36        1.60
     -4.988 |         10        0.52        2.12
     -4.554 |         16        0.83        2.94
     -4.206 |         14        0.72        3.67
     -3.908 |          9        0.46        4.13
     -3.644 |         25        1.29        5.42
     -3.404 |         32        1.65        7.08
     -3.182 |         43        2.22        9.30
     -2.975 |         60        3.10       12.40
     -2.779 |         65        3.36       15.75
     -2.592 |         91        4.70       20.45
     -2.413 |        114        5.89       26.34
     -2.239 |        113        5.84       32.18
     -2.071 |        146        7.54       39.72
     -1.906 |        155        8.01       47.73
     -1.744 |        154        7.95       55.68
     -1.584 |        105        5.42       61.11
     -1.426 |        117        6.04       67.15
     -1.268 |        107        5.53       72.68
      -1.11 |         82        4.24       76.91
       -.95 |         84        4.34       81.25
      -.789 |         73        3.77       85.02
      -.624 |         60        3.10       88.12
      -.454 |         47        2.43       90.55
      -.278 |         51        2.63       93.18
      -.093 |         51        2.63       95.82
       .104 |         29        1.50       97.31
       .316 |         23        1.19       98.50
        .55 |         14        0.72       99.23
       .815 |         13        0.67       99.90
      1.129 |          2        0.10      100.00
------------+-----------------------------------
      Total |      1,936      100.00

*/
gen maths_irt = 9 + ltscore
gen round =4


tab mtscore1
/*
   mtscore1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         24        1.24        1.24
          3 |          7        0.36        1.60
          4 |         26        1.34        2.94
          5 |         48        2.48        5.42
          6 |        291       15.03       20.45
          7 |        787       40.65       61.11
          8 |        523       27.01       88.12
          9 |        201       10.38       98.50
         10 |         29        1.50      100.00
------------+-----------------------------------
      Total |      1,936      100.00
*/
save "ltscorer4_maths.dta",replace

* ROUND 5

use "vn_r5_yccog_youngerchild.dta",clear
gen childid="VN"+string(CHILDCODE, "%06.0f")
drop if MATHTEST==0

keep childid correct*maths maths_raw
rename correct*maths correct*
rename correct0* correct*


forvalues num =1/31{
      replace correct`num' = 0 if correct`num'==.
   }

tabulate maths_raw
/*
  Raw score |
    in Math |
       Test |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |          8        0.42        0.42
          1 |          9        0.48        0.90
          2 |         11        0.58        1.48
          3 |         16        0.85        2.33
          4 |         29        1.54        3.87
          5 |         50        2.65        6.51
          6 |         73        3.87       10.38
          7 |        102        5.40       15.78
          8 |        111        5.88       21.66
          9 |        120        6.36       28.02
         10 |         99        5.24       33.26
         11 |        117        6.20       39.46
         12 |         93        4.93       44.39
         13 |         84        4.45       48.83
         14 |         96        5.08       53.92
         15 |         95        5.03       58.95
         16 |         74        3.92       62.87
         17 |         87        4.61       67.48
         18 |         69        3.65       71.13
         19 |         82        4.34       75.48
         20 |         66        3.50       78.97
         21 |         67        3.55       82.52
         22 |         67        3.55       86.07
         23 |         43        2.28       88.35
         24 |         60        3.18       91.53
         25 |         47        2.49       94.01
         26 |         43        2.28       96.29
         27 |         30        1.59       97.88
         28 |         22        1.17       99.05
         29 |         13        0.69       99.74
         30 |          5        0.26      100.00
------------+-----------------------------------
      Total |      1,888      100.00
*/


raschtest correct1-correct31,id( childid)

raschtest correct1-correct31,id(childid) genlt(ltscore)

/*

Estimation method: Conditional maximum likelihood (CML)
Number of items: 31
Number of groups: 32
Number of individuals: 1890
Number of individuals with missing values: 0 (removed)
Number of individuals with nul or perfect score: 10
Conditional log-likelihood: -24671.3752  
Log-likelihood: -27904.1096  
               Difficulty
        Items  parameters  std Err.
-----------------------------------
      correct1   -2.63539   0.08894
      correct2   -2.12167   0.08860
      correct3   -2.57177   0.08884
      correct4   -0.14428   0.09813
      correct5   -4.40079   0.10157
      correct6   -3.47755   0.09216
      correct8   -3.21812   0.09075
      correct9   -2.17391   0.08859
     correct10   -2.20959   0.08858
     correct11   -2.00010   0.08867
     correct12   -3.37715   0.09157
     correct13   -3.25801   0.09094
     correct14   -1.57667   0.08936
     correct15   -0.18573   0.09769
     correct16   -1.79269   0.08892
     correct17   -1.36127   0.08999
     correct18   -2.30550   0.08860
     correct19   -0.01982   0.09956
     correct20   -3.12753   0.09036
     correct21   -2.17940   0.08858
     correct22   -1.85202   0.08883
     correct23   -2.24524   0.08858
     correct24   -1.86609   0.08881
     correct26   -3.09181   0.09021
     correct27   -2.02782   0.08865
     correct29   -1.67260   0.08914
      correct7   -3.31082   0.09121
     correct25    0.27760   0.10359
     correct28   -0.39061   0.09571
     correct30    0.61170   0.10936
    correct31*    0.00000        .
-----------------------------------
*: The difficulty parameter of this item had been fixed to 0



                                Ability                    Expected
                Group Score  parameters  std Err.    Freq.    Score
                ---------------------------------------------------
                    0     0      -6.726     1.491       10     0.47
                ---------------------------------------------------
                    1     1      -5.547     0.886        9     1.41
                ---------------------------------------------------
                    2     2      -4.959     0.706       11     2.36
                ---------------------------------------------------
                    3     3      -4.546     0.613       16     3.32
                ---------------------------------------------------
                    4     4      -4.220     0.555       29     4.28
                ---------------------------------------------------
                    5     5      -3.944     0.516       50     5.25
                ---------------------------------------------------
                    6     6      -3.701     0.487       73     6.22
                ---------------------------------------------------
                    7     7      -3.481     0.466      102     7.19
                ---------------------------------------------------
                    8     8      -3.278     0.449      111     8.16
                ---------------------------------------------------
                    9     9      -3.088     0.437      120     9.13
                ---------------------------------------------------
                   10    10      -2.906     0.427       99     10.11
                ---------------------------------------------------
                   11    11      -2.731     0.420      117     11.08
                ---------------------------------------------------
                   12    12      -2.561     0.415       93     12.06
                ---------------------------------------------------
                   13    13      -2.394     0.412       84     13.03
                ---------------------------------------------------
                   14    14      -2.228     0.411       96     14.01
                ---------------------------------------------------
                   15    15      -2.063     0.411       95     14.99
                ---------------------------------------------------
                   16    16      -1.897     0.413       74     15.97
                ---------------------------------------------------
                   17    17      -1.730     0.416       87     16.94
                ---------------------------------------------------
                   18    18      -1.558     0.420       69     17.93
                ---------------------------------------------------
                   19    19      -1.382     0.427       82     18.91
                ---------------------------------------------------
                   20    20      -1.200     0.435       66     19.89
                ---------------------------------------------------
                   21    21      -1.010     0.445       67     20.87
                ---------------------------------------------------
                   22    22      -0.810     0.457       67     21.86
                ---------------------------------------------------
                   23    23      -0.598     0.471       43     22.84
                ---------------------------------------------------
                   24    24      -0.372     0.489       60     23.83
                ---------------------------------------------------
                   25    25      -0.126     0.511       47     24.81
                ---------------------------------------------------
                   26    26       0.143     0.540       43     25.79
                ---------------------------------------------------
                   27    27       0.446     0.579       30     26.76
                ---------------------------------------------------
                   28    28       0.798     0.635       22     27.72
                ---------------------------------------------------
                   29    29       1.235     0.726       13     28.67
                ---------------------------------------------------
                   30    30       1.844     0.904        5     29.61
                ---------------------------------------------------
                   31    31       3.038     1.507        0     30.54
                ---------------------------------------------------
*/
gen maths_irt = 50 + 10*ltscore

save "ltscorer5_maths.dta",replace

. tab ltscore
/*
    ltscore |      Freq.     Percent        Cum.
------------+-----------------------------------
     -6.726 |         10        0.53        0.53
     -5.547 |          9        0.48        1.01
     -4.959 |         11        0.58        1.59
     -4.546 |         16        0.85        2.43
      -4.22 |         29        1.53        3.97
     -3.944 |         50        2.65        6.61
     -3.701 |         73        3.86       10.48
     -3.481 |        102        5.40       15.87
     -3.278 |        111        5.87       21.75
     -3.088 |        120        6.35       28.10
     -2.906 |         99        5.24       33.33
     -2.731 |        117        6.19       39.52
     -2.561 |         93        4.92       44.44
     -2.394 |         84        4.44       48.89
     -2.228 |         96        5.08       53.97
     -2.063 |         95        5.03       58.99
     -1.897 |         74        3.92       62.91
      -1.73 |         87        4.60       67.51
     -1.558 |         69        3.65       71.16
     -1.382 |         82        4.34       75.50
       -1.2 |         66        3.49       78.99
      -1.01 |         67        3.54       82.54
       -.81 |         67        3.54       86.08
      -.598 |         43        2.28       88.36
      -.372 |         60        3.17       91.53
      -.126 |         47        2.49       94.02
       .143 |         43        2.28       96.30
       .446 |         30        1.59       97.88
       .798 |         22        1.16       99.05
      1.235 |         13        0.69       99.74
      1.844 |          5        0.26      100.00
------------+-----------------------------------
      Total |      1,890      100.00
*/
. gen mtscore1=8+ltscore

. rename mtscore1 mtscore

. gen mtscore1 = round(mtscore)

. tab mtscore1
/*
   mtscore1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         10        0.53        0.53
          2 |          9        0.48        1.01
          3 |         27        1.43        2.43
          4 |        152        8.04       10.48
          5 |        642       33.97       44.44
          6 |        505       26.72       71.16
          7 |        325       17.20       88.36
          8 |        180        9.52       97.88
          9 |         35        1.85       99.74
         10 |          5        0.26      100.00
------------+-----------------------------------
     Total |      1,890      100.00
*/
. replace maths_raw =math if maths_raw==.
(1,923 real changes made)

. drop math math_co

. save "mathstest_yl345.dta"

. order childid round

. sort childid round

. tab round, summarize( ltscore)
/*
            |         Summary of ltscore
      round |        Mean   Std. Dev.       Freq.
------------+------------------------------------
          4 |  -1.8023611   1.1645003       1,936
          5 |  -2.1611185   1.2998368       1,890
------------+------------------------------------
      Total |  -1.9795831   1.2460318       3,826
*/

merge m:1 childid using "r5childid.dta"


*******************************************************************************
use `mathtestr3',clear
append using `mathtestr4'
append using `mathtestr5'

twoway kdensity maths_raw if round==3 || kdensity maths_raw if round==5
